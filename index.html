<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<meta http-equiv='X-UA-Compatible' content='IE=edge'>
		<title>Protein-Go demo</title>
		<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
		<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.js"></script>
	   	<script src="https://google-ar.github.io/three.ar.js/dist/three.ar.js"></script>
		<script src="https://rawgit.com/chenzlabs/aframe-ar/827e9db/dist/aframe-ar.min.js"></script>
		<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/cfe5f316/dist/aframe-extras.js"></script>
	</head>
	<body>
		<a-scene ar vr-mode-ui="enabled: false"
				embedded 
			 arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; 
			       displayHeight: 960; debugUIEnabled: false; trackingMethod: best;' 
			 webxr="requiredFeatures: hit-test,local-floor;
				optionalFeatures: dom-overlay,unbounded;
				overlayElement: #overlay;">
			<a-entity position="0 0 -40" scale ="0.1 0.1 0.1">
				<a-gltf-model id="capsid" src="separated_colored.glb" rotation="0 -90 0" shadow="cast: true"></a-gltf-model>
			</a-entity>
			<a-entity position="0 -0.5 1">
				<a-camera ar-raycaster raycaster cursor="fuse:false">
					<a-ring id="cursor" color="teal" radius-inner="0.02" radius-outer="0.03" position="0 -3 -3" rotation="-90 0 0"></a-ring>
				</a-camera>
			</a-entity>
		</a-scene>
		<script type="text/javascript">
		      function onSceneLoaded() {
			const raycaster = document.querySelector('[ar-raycaster]');
			const cursor = document.querySelector('#cursor');
			raycaster.addEventListener('raycaster-intersection', (event) => {
			  cursor.setAttribute('position', event.detail.intersections[0].point);
			});

			const capsid = document.querySelector('#capsid');
			const { stringify } = AFRAME.utils.coordinates;

			let firstTime = true;
			raycaster.addEventListener('click', () => {
			  const target = raycaster.components.cursor.intersection.point;

			  if (firstTime) {
			    capsid.setAttribute('position', target);
			    firstTime = false;
			  } else {
			    const currentPosition = capsid.object3D.position;
			    const distance = currentPosition.distanceTo(target);

			    capsid.object3D.lookAt(target);

			    const animation = document.createElement('a-animation');
			    animation.setAttribute('attribute', 'position');
			    animation.setAttribute('to', stringify(target));
			    animation.setAttribute('dur', distance * 7000);
			    animation.setAttribute('easing', 'linear');
			    capsid.appendChild(animation);
			  }
			});
		      }

		      const scene = document.querySelector('a-scene');
		      scene.addEventListener('loaded', onSceneLoaded);
		    </script>
	</body>
</html>
